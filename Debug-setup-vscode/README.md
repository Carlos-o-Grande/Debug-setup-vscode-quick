# Debugging with GDB and VS Code

### Setup VS Code debugging (quickly)
If you never used a debugger before or never configure it on VS Code, stay a while and listen.
 *All instructions refer to files in /examples folder*.   <br />

First image will guide you at starting the config process. Just click where pointed.

![1_setup](https://github.com/Carlos-o-Grande/Debug-setup-vscode-quick/blob/main/Debug-setup-vscode/assets/1_setup.png)

- When you have done that, on VS Code explorer (1st button on top left) there is a new folder `.vscode` with the file `launch.json`.
- Copy `launch.json` and `tasks.json` on '/examples' to `.vscode` folder to follow this guide.

<br />
Files are commented where is relevant. Here they are edited for brevity.

#### launch.json
```json
"configurations": [
// Launch configurations available:
// - "Compile & Launch" - Compiles and runs your active file
// - "Makefile & Launch" - Runs "make debug" before lauching
// - "Launch (no build)" - Just runs the existing program

// this launch option runs the executable but before executes "preLaunchTask": "C/C++: gcc build active file" (see tasks.json)
// "program": "${workspaceFolder}/" *ballons.out* can be replaced by a variable expanded on launch
// we also setup args[] to 99, this executes "ballons.out 99" setting the argv of the program
	{
		"name": "Compile & Launch",
		"type": "cppdbg",
		"request": "launch",
		"program": "${workspaceFolder}/${fileBasenameNoExtension}.out",
		"args": [
			"99",
		],
		"stopAtEntry": true,	//optional, if true debugger always stop at first instruction
		"cwd": "${fileDirname}",
		"environment": [],

		"externalConsole": false,
		"MIMode": "gdb",
		"preLaunchTask": "C/C++: gcc build active file",	//important, corresponds to label on tasks.json
		[...omitted...],
	},
// this launch option runs the executable but before executes  "preLaunchTask": "Makefile" (see tasks.json)
	{
		"name": "Makefile & Launch",
		"program": "${workspaceFolder}/ballons.out",
		"args": [],
		"preLaunchTask": "Makefile",
	},
	// this launch option just executes the program
	{
		"name": "Launch (no build)",
		"program": "${workspaceFolder}/ballons.out",
		}
```
---
<br />

#### tasks.json
```json

"tasks": [
	// this task runs "cc". args[] is used to setup command options.
	// in this example: cc -fdiagnostics-color=always -g3 ${file} -o ${fileDirname}/ballons.out
	// ${file} is the active file on the editor.
	// For this example can be explicitly replaced with main.c
	// the "label": "cc build" is how launch.json identifies the task to run
	{
		"type": "cppbuild",
		"label": "C/C++: gcc build active file",	//important
		"command": "/usr/bin/cc",
		"args": [
			"-fdiagnostics-color=always",
			"-g",			// see end of readme for explanation of this flag
			"${file}",
			"-o",
			"${fileDirname}/${fileBasenameNoExtension}.out"
		],
		"options": {
			"cwd": "${fileDirname}"
		},
			"problemMatcher": [
			"$gcc"
		],
		"group": "build",
		"detail": "Task generated by Debugger."
	},
	// this task runs 'make debug'. see your Makefile file and 'Makefile & Launch' in launch.json
	// For how to setup makefile, see end of this readme.
	{
		"type": "cppbuild",
		"label": "Makefile",	//important
		"command": "make",
		"args": [
			"debug"
		],
		"group": {
			"kind": "build",
			"isDefault": true
		},
		"detail": "run makefile"
	}
```
<br /><br />

### Now we are ready to debug our code:

![2_debug](https://github.com/Carlos-o-Grande/Debug-setup-vscode-quick/blob/main/Debug-setup-vscode/assets/2_debug.png)

1. Dropdown with the options from launch.json
2. debugger toolbar (more on that below)
3. breakpoint
4. variables to watch
5. terminal for program output

Select a option from (1) and click the green play icon (F5 also works).
 VS Code will compile and launch.
> [!IMPORTANT]
> Make sure `YourFile.c` is open and active before launching anything.
<br />

#### The debugger toolbar will appear.
if `"stopAtEntry": true,` there will be a yellow arrow at line 50 pointing to the first instruction `int cnt = 5;`
Otherwise it will point to first breakpoint, if there isn't one, program writes to terminal and ends.
To setup a breakpoint click to the left of line number. Try setting the breakpoints like in the image.
If you want to keep track a variable click the + on box 4 and write the name.

> [!TIP]
> If the variable is passed as a argument it will keep track across functions.
> some common variable names like `len, i` will change when entering functions to reflect the new scope.
<br />

### Debugger toolbar
![3_toolbar](https://github.com/Carlos-o-Grande/Debug-setup-vscode-quick/blob/main/Debug-setup-vscode/assets/toolbar.png)

from left to right:
- PLAY - goes to the next breakpoint
-  STEP OVER - follow line by line but doesn't follow functions
- STEP INTO - goes inside the function if on a line that uses one
- you figure that one
- RESTART
- STOP
<br /><br />

# That's it.
Done. For new projects just copy the `.vscode` folder and it's contents and do some refactoring.
---
<br /><br />

# Appendix
<br />

## CC debug flag: `-g`

The `-g` flag tells the CC compiler to produce debugging information.
This information is stored in the executable file and used by GDB
to let you step through your code, inspect variables, and see where crashes happen.
---

### `-g` or `-g2` (Default Level)

 *   **Behavior:** Includes
      - function names
      - line numbers
      - local and global variables
      - defined types
      - source file information

*   **Debugging:** This is the standard for day-to-day debugging. It allows you to step through code, inspect the values of most variables, and see the full source code in the debugger.
---

### No `-g` or `-g0`

This level means no debugging information is generated.

*   **Behavior:** The resulting executable is smaller, but debugging is nearly impossible.
*   **Debugging:** You cannot see source code lines, inspect local variables, or get meaningful backtraces. You might only see function names if the symbol table isn't stripped.
*   **Use Case:** Final release builds.
---
<br />

## Are you using a Makefile?
To enable debugging support in your Makefile, add these lines after your `all` rule:
```makefile
# Add debug symbols while keeping your existing compilation flags
debug: CFLAGS += -g
debug: re
```
This creates a 'debug' rule that adds the -g flag for debugging information. Then just call it like this:
```
make debug
```

---
<br />

## VS Code Variables
For customizing the launch configurations, VS Code uses variables. These are explained in the [VS Code Variables Reference](https://code.visualstudio.com/docs/editor/variables-reference).

Some examples:
- `${file}` - Full path of current file
- `${fileBasename}` - Current file with extension
- `${fileBasenameNoExtension}` - Current file without extension
- `${fileDirname}` - Directory containing current file
- `${workspaceFolder}` - Root folder of your project
